#! /bin/bash

#coding: utf-8
################################################################
# CLEAN ENERGY SOLUTIONS - 2018
#
# Setup
#
# Create by: EmÃ­lio Palote Santos
#
# Repository: https://github.com/cleanenergy/DataCollector
#
# This code setup a autostart to DataCollector system after the login
#
################################################################

# Verify if exist old configurations 
if grep -q dev/DataCollector/DataCollector "$HOME/.config/lxsession/LXDE-pi/autostart"
then
	sudo crontab -l > $HOME/dev/DataCollector/tempcron

	if grep -q dev/DataCollector/cronrun "$HOME/dev/DataCollector/tempcron"
	then
		rm $HOME/dev/DataCollector/tempcron
		exit 1
	fi
	echo "* * * * * sudo $HOME/dev/DataCollector/cronrun" >> $HOME/dev/DataCollector/tempcron
	echo "* * * * * $HOME/dev/DataCollector/DataCollector" >> $HOME/dev/DataCollector/tempcron
	sudo crontab $HOME/dev/DataCollector/tempcron
	rm $HOME/dev/DataCollector/tempcron
	exit 1

fi
# If not

# Adjust Crontab
sudo crontab -l > $HOME/dev/DataCollector/tempcron
echo "* * * * * sudo $HOME/dev/DataCollector/cronrun" >> $HOME/dev/DataCollector/tempcron
echo "* * * * * $HOME/dev/DataCollector/DataCollector" >> $HOME/dev/DataCollector/tempcron
sudo crontab $HOME/dev/DataCollector/tempcron
rm $HOME/dev/DataCollector/tempcron

# Adjust 
echo "@$HOME/dev/DataCollector/DataCollector" >> $HOME/.config/lxsession/LXDE-pi/autostart
